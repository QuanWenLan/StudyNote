##### es如何支持百万数据查询的

##### 新增一个数据索引到es，如果添加到MySQL成功，es失败，有什么方案可以解决吗

- **异步处理**：将MySQL和Elasticsearch的数据添加操作分别放入消息队列中，然后由异步任务进行处理。这样，即使其中一个操作失败，也不会影响另一个操作。你可以使用消息队列，如RabbitMQ或Kafka，并创建消费者来监听队列中的消息并处理相应的数据。
- **定时同步**：定期检查MySQL中的数据，然后使用定时任务将数据同步到Elasticsearch中。这种方法虽然不是实时的，但是可以确保数据最终一致性。你可以使用Spring的`@Scheduled`注解来实现定时任务。可以在product记录一个字段用来判断是否被索引到es。
- **重试机制**：如果一次添加数据到Elasticsearch失败，可以实现一个重试机制来重新尝试添加数据。你可以在应用程序中实现一个定时任务或者监控程序，定期检查失败的操作并进行重试，直到操作成功为止。

##### 使用Elasticsearch作为商城搜索框的后端实现，可能会遇到以下一些常见问题：

1. **性能问题**：随着数据量的增长，搜索性能可能会下降。为了应对这个问题，需要优化索引结构、查询语句以及硬件配置，并且定期监控和调整系统性能。
2. **数据一致性**：Elasticsearch的分布式特性可能导致索引数据与底层数据源（如数据库）之间的一致性问题。确保索引数据与底层数据源保持一致是非常重要的，可能需要使用定时同步、实时同步或者其他数据同步机制。
3. **搜索结果的准确性**：搜索结果的准确性对于商城非常重要。需要确保搜索引擎能够正确解析用户的查询请求，并返回与用户意图相关的结果。可能需要调整分析器、过滤器、权重等配置参数来优化搜索结果的质量。
4. **分词和匹配问题**：分词器对于搜索结果的准确性非常重要。如果分词器配置不当，可能会导致搜索结果不准确或不完整。需要根据商城的特点和用户的搜索习惯选择合适的分词器，并根据需要自定义分词规则。
5. **搜索建议和纠错**：商城搜索框通常需要提供搜索建议和纠错功能，以帮助用户更快地找到他们想要的商品。需要实现自动补全、拼写纠错、近义词扩展等功能，并确保搜索建议和纠错的准确性和实用性。
6. **搜索排名和排序**：商城搜索结果的排名和排序对于用户体验至关重要。需要根据商品的相关性、销量、评价等因素进行合理的排序，并提供个性化的搜索体验，以满足用户的需求。
7. **敏感数据保护**：商城可能涉及用户的个人信息、订单信息等敏感数据，需要确保这些数据在索引过程中得到合理的保护，防止数据泄露或被滥用。
8. **错误处理和监控**：需要建立完善的错误处理机制和监控系统，及时发现和处理搜索系统中的错误和异常情况，以确保系统的稳定性和可靠性。

##### 针对产品的多个索引搜索

产品可以设置为product开头，多个可能是product-1，product-2等等

```console
GET /product-*/_search
{
  "query": {
    "match": {
      "name": "kimchy"
    }
  }
}
```
